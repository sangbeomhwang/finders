<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시글 작성</title>
    <style>
        .container {
            width: 50%;
            margin: 0 auto;
            text-align: center;
        }

        .scope-of-work {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .scope-option {
            border: 1px solid #ddd;
            padding: 20px;
            width: 120px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .scope-option:hover {
            border-color: #28a745;
        }

        .scope-option.selected {
            border-color: #28a745;
            background-color: #f0f8f5;
        }

        .scope-option img {
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
        }

        .scope-option input[type="checkbox"] {
            display: none;
        }

        .project-title-container {
            text-align: left;
            margin-bottom: 20px;
        }

        .project-title-container input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
        }
        .category-container {
            width: 50%;
            margin: 0 auto;
        }

        .category-section {
            margin-bottom: 30px;
        }

        .category-section h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            background-color: #f5f5f5;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .category-btn:hover {
            background-color: #e0e0e0;
        }

        .category-btn.selected {
            background-color: #28a745;
            color: #fff;
            border-color: #28a745;
        }

        /* 이미지 업로드 섹션 */
        .image-upload-section {
            margin-top: 30px;
        }

        .image-upload-section h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .uploaded-file {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .uploaded-file img {
            margin-right: 10px;
        }

        .file-upload-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background-color: #f5f5f5;
            cursor: pointer;
            transition: background-color 0.3s;
            border-radius: 5px;
        }

        .file-upload-btn:hover {
            background-color: #e0e0e0;
        }
        .tech-container {
            width: 50%;
            margin: 0 auto;
        }

        .selected-techs {
            background-color: #f0f8f5;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .selected-tech {
            background-color: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .tech-section h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .tech-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tech-button {
            padding: 10px 20px;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            background-color: #f5f5f5;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .tech-button:hover {
            background-color: #e0e0e0;
        }

        .tech-button.selected {
            background-color: #28a745;
            color: #fff;
            border-color: #28a745;
        }

        .detail-section {
            margin-top: 20px;
        }

        .detail-section textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .char-count {
            text-align: right;
            margin-top: 5px;
            font-size: 12px;
            color: #888;
        }

        .budget-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin: 20px auto;
            max-width: 1000px;
        }

        .budget-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 300px;
        }

        .budget-item label {
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .budget-item input[type="text"],
        .budget-item input[type="date"] {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1.1em;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .checkbox-container input[type="checkbox"] {
            margin-right: 10px;
        }

        .recruit-container {
            width: 50%;
            margin: 0 auto;
        }

        .recruit-section {
            margin-bottom: 20px;
        }

        .recruit-section label {
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .recruit-section input,
        .recruit-section select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
        }

        .recruit-team-section {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 5px; /* 간격 추가 */
        }

        /* 모집 인원의 Select 크기 조정 */
        .recruit-team-section select {
            width: 100px; /* Select 옵션 크기 줄이기 */
        }

        /* 모집 인원의 Input 크기 조정 */
        .recruit-team-section input {
            width: 50px; /* 입력 필드 크기 줄이기 */
        }

        .recruit-add-button {
            cursor: pointer;
            color: #28a745;
            font-size: 0.9em;
        }

        /* 동적으로 추가되는 질문 섹션 */
        .recruit-added-section {
            width: calc(100%);
            margin-top: 10px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
        }

        /* 동적으로 추가되는 질문 섹션 */
        .recruit-added-item select{
            width: 100px;
        }

        .recruit-added-item input{
            width: 50px;
        }

        .recruit-question-input {
            width: calc(90% - 60px);
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .recruit-question-section .recruit-add-button {
            margin-left: 0;
        }
    </style>

    <script>
        let selectedScopes = [];
        // 업무 범위 선택 기능 (다중 선택 가능)
        function toggleSelect(element) {
            element.classList.toggle('selected');
            const scope = element.querySelector('input[type="checkbox"]').value;

            // 선택된 상태라면 배열에 추가
            if (element.classList.contains('selected')) {
                selectedScopes.push(scope);
            } else {
                // 선택 해제되면 배열에서 제거
                selectedScopes = selectedScopes.filter(s => s !== scope);
            }

            // 숨겨진 input 필드에 선택된 값을 저장 (폼 제출용)
            document.getElementById('selectedWorkScopes').value = selectedScopes.join(',');

            // 모집 인원의 select 필드 업데이트
            updateRecruitSelectOptions();
        }

        // 모집 인원 select 필드 업데이트 함수
        function updateRecruitSelectOptions() {
            const recruitSelects = document.querySelectorAll('.recruit-team-section select[name="role"], .recruit-added-item select[name="role"]');

            recruitSelects.forEach(select => {
                // select 필드의 모든 옵션 제거
                select.innerHTML = '';

                // 선택된 업무 범위를 기준으로 옵션 추가
                selectedScopes.forEach(scope => {
                    const option = document.createElement('option');
                    option.value = scope;
                    option.textContent = scope;
                    select.appendChild(option);
                });
            });
        }

        let selectedCategories = [];
        // 카테고리 선택 기능 (다중 선택 가능)
        function toggleCategory(element) {
            element.classList.toggle('selected');
            const category = element.dataset.category;

            // 선택된 상태라면 배열에 추가
            if (element.classList.contains('selected')) {
                selectedCategories.push(category);
            } else {
                // 선택 해제되면 배열에서 제거
                selectedCategories = selectedCategories.filter(c => c !== category);
            }

            // 숨겨진 input 필드에 선택된 카테고리 저장
            document.getElementById('selectedCategories').value = selectedCategories.join(',');

            // 모집 인원의 카테고리 select 필드 업데이트
            updateRecruitCategoryOptions();
        }

        // 모집 인원 category select 필드 업데이트 함수
        function updateRecruitCategoryOptions() {
            const recruitCategorySelects = document.querySelectorAll('.recruit-team-section select[name="category"], .recruit-added-item select[name="category"]');

            recruitCategorySelects.forEach(select => {
                // select 필드의 모든 옵션 제거
                select.innerHTML = '';

                // 선택된 카테고리를 기준으로 옵션 추가
                selectedCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    select.appendChild(option);
                });
            });
        }

        // 선택한 기술들을 저장할 배열
        let selectedTechs = [];

        // 기술 버튼 클릭 시 호출되는 함수
        function toggleTech(element) {
            const tech = element.getAttribute('data-tech');  // data-tech 속성에서 기술명 가져오기
            const selectedTechsContainer = document.getElementById('selected-techs');

            // 선택된 상태라면 선택 해제
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedTechs = selectedTechs.filter(t => t !== tech);  // 배열에서 제거
            } else {
                // 선택되지 않은 상태라면 선택 추가
                element.classList.add('selected');
                selectedTechs.push(tech);  // 배열에 추가
            }
            // 선택된 기술들을 상단에 표시
            selectedTechsContainer.innerHTML = selectedTechs
                .map(item => `<span class="selected-tech">${item}</span>`)
                .join('');
        }

        const checkFormInterval = setInterval(function() {
            const form = document.querySelector('form');
            if (form) {
                // 폼에 이벤트 리스너 추가
                form.addEventListener('submit', function(event) {
                    const selectedSkillsInput = document.getElementById('selectedSkills');
                    selectedSkillsInput.value = selectedTechs.join(',');
                });
                // 폼이 발견되면 더 이상 확인하지 않음
                clearInterval(checkFormInterval);
            }
        }, 500);  // 0.5초마다 확인

        // 상세 업무 내용 글자 수 카운팅
        function countCharacters() {
            const detailTextarea = document.getElementById('detail-text');
            const charCount = document.getElementById('char-count');

            console.log(detailTextarea, charCount);

            detailTextarea.addEventListener('input', function () {
                const length = detailTextarea.value.length;
                charCount.textContent = `${length} / 5000`;
            });
        }

        // 모집 인원 추가 기능
        function addTeamMember() {
            const teamMembersContainer = document.getElementById('recruit-team-members');

            // 새로운 팀원 입력 필드 생성
            const newTeamMember = document.createElement('div');
            newTeamMember.classList.add('recruit-added-item');
            newTeamMember.innerHTML = `
                <select name="role"></select>
                <select name="category"></select>
                <input type="number" min="1" placeholder="명" name="teamSize[]">
            `;
            teamMembersContainer.appendChild(newTeamMember);

            // 새로 추가된 팀원의 role select 필드 업데이트
            updateRecruitSelectOptions();
            updateRecruitCategoryOptions();
        }

        // 사전 검증 질문 추가 기능
        function addQuestion() {
            const questionsContainer = document.getElementById('recruit-questions');

            // 새로운 질문 입력 필드 생성
            const newQuestion = document.createElement('div');
            newQuestion.classList.add('recruit-added-question');
            newQuestion.innerHTML = `
                <input type="text" class="recruit-question-input" placeholder="사전 질문을 입력해주세요." name="question[]">
            `;
            questionsContainer.appendChild(newQuestion);
        }

        // Call the character counting function on page load
        window.onload = function () {
            countCharacters();
        };
    </script>
</head>
<body>
<form method="POST" action="/board/write" enctype="multipart/form-data">
    <div class="container">
        <h2>기본 정보</h2>

        <div class="project-title-container">
            <label for="project-title">프로젝트 제목</label><br>
            <input type="text" id="project-title" name="projectTitle" maxlength="30" placeholder="프로젝트 제목을 입력하세요">
        </div>

        <div class="scope-of-work">
            <label for="project-title">업무범위</label><br>
            <div class="scope-option" onclick="toggleSelect(this)" data-scope="개발">
                <input type="checkbox" value="개발">
                <img src="https://via.placeholder.com/50" alt="개발">
                <p>개발</p>
            </div>

            <div class="scope-option" onclick="toggleSelect(this)" data-scope="디자인">
                <input type="checkbox" value="디자인">
                <img src="https://via.placeholder.com/50" alt="디자인">
                <p>디자인</p>
            </div>

            <div class="scope-option" onclick="toggleSelect(this)" data-scope="기획">
                <input type="checkbox" value="기획">
                <img src="https://via.placeholder.com/50" alt="기획">
                <p>기획</p>
            </div>

            <div class="scope-option" onclick="toggleSelect(this)" data-scope="기타">
                <input type="checkbox" value="기타">
                <img src="https://via.placeholder.com/50" alt="기타">
                <p>기타</p>
            </div>
            <input type="hidden" id="selectedWorkScopes" name="selectedWorkScopes">
        </div>

        <!-- 카테고리 -->
        <div class="category-container">
            <div class="category-section">
                <h3>카테고리</h3>
                <p>해당하는 카테고리를 모두 선택해주세요.</p>
                <div class="category-buttons">
                    <div class="category-btn" onclick="toggleCategory(this)" data-category="웹">웹</div>
                    <div class="category-btn" onclick="toggleCategory(this)" data-category="안드로이드">안드로이드</div>
                    <div class="category-btn" onclick="toggleCategory(this)" data-category="iOS">iOS</div>
                    <div class="category-btn" onclick="toggleCategory(this)" data-category="PC 프로그램">PC 프로그램</div>
                    <div class="category-btn" onclick="toggleCategory(this)" data-category="임베디드">임베디드</div>
                    <div class="category-btn" onclick="toggleCategory(this)" data-category="기타">기타</div>
                </div>
                <input type="hidden" id="selectedCategories" name="selectedCategories">
            </div>
        </div>

        <!-- 이미지 업로드 -->
        <div class="image-upload-section">
            <h3>프로젝트 이미지</h3>
            <p>프로젝트 찾기 창에서 보일 프로젝트 대표 이미지를 넣어주세요. (최대 1개)</p>
            <input type="file" name="projectImageFile" accept="image/png, image/jpeg">
        </div>

        <!-- 제출 버튼 -->
        <div>
            <button type="submit">저장</button>
        </div>
    </div>

    <div class="tech-container">
        <input type="hidden" id="selectedSkills" name="selectedSkills">
        <!-- 선택된 기술 표시 박스 -->
        <div class="selected-techs" id="selected-techs">
            <!-- 선택한 기술들이 여기에 표시됩니다. -->
        </div>

        <!-- 관련 기술 선택 섹션 -->
        <div class="tech-section">
            <h3>관련 기술</h3>
            <p>프로젝트에서 활용될 기술에 대해 모두 선택해주세요.</p>
            <div class="tech-buttons">
                <div class="tech-button" data-tech="Python" onclick="toggleTech(this)">Python</div>
                <div class="tech-button" data-tech="Javascript" onclick="toggleTech(this)">Javascript</div>
                <div class="tech-button" data-tech="JAVA" onclick="toggleTech(this)">JAVA</div>
                <div class="tech-button" data-tech="C++" onclick="toggleTech(this)">C++</div>
                <div class="tech-button" data-tech="iOS" onclick="toggleTech(this)">iOS</div>
                <div class="tech-button" data-tech="안드로이드" onclick="toggleTech(this)">안드로이드</div>
            </div>
        </div>

        <!-- 상세 업무 내용 섹션 -->
        <div class="detail-section">
            <h3>상세업무 내용</h3>
            <p>프로젝트와 관련된 상세한 내용들을 기입해주세요.</p>
            <textarea id="detail-text" name="projectDescription" rows="5" maxlength="5000" placeholder="5000자 이내로 작성해주세요."></textarea>
            <p class="char-count" id="char-count">0 / 5000</p>
        </div>
    </div>

    <div class="budget-container">
        <!-- 지출 가능 예산 -->
        <div class="budget-item">
            <label for="budget">지출 가능 예산</label>
            <input type="text" id="budget" name="projectBudget" placeholder="300,000 ￦">
            <div class="checkbox-container">
                <input type="checkbox" id="flexible">
                <label for="flexible">입력한 예산에서 조율이 가능합니다.</label>
            </div>
        </div>

        <!-- 프로젝트 시작일 -->
        <div class="budget-item">
            <label for="start-date">프로젝트 시작일</label>
            <input type="date" id="start-date" name="projectStartDate">
        </div>

        <!-- 프로젝트 종료일 -->
        <div class="budget-item">
            <label for="end-date">프로젝트 종료일</label>
            <input type="date" id="end-date" name="projectEndDate">
        </div>
    </div>

    <div class="recruit-container">
        <!-- 모집 마감일 -->
        <div class="recruit-section">
            <label for="recruit_deadline">모집 마감일</label>
            <input type="datetime-local" id="recruit_deadline" name="recruitDeadline">
        </div>

        <!-- 모집 인원 -->
        <div class="recruit-section">
            <label>모집 인원</label>
            <div class="recruit-team-section">
                <select name="role"></select>
                <select name="category"></select>
                <input type="number" min="1" value="3" placeholder="명" name="teamSize[]">
                <span class="recruit-add-button" onclick="addTeamMember()">추가 +</span>
            </div>
            <div id="recruit-team-members"></div>
        </div>

        <!-- 사전 검증 질문 -->
        <div class="recruit-section">
            <label>사전 검증 질문</label>
            <div class="recruit-question-section">
                <input type="text" class="recruit-question-input" placeholder="사전 질문을 입력해주세요." name="question[]">
                <span class="recruit-add-button" onclick="addQuestion()">추가 +</span>
            </div>
            <!-- 추가되는 질문 필드가 여기에 표시됨 -->
            <div id="recruit-questions"></div>
        </div>
    </div>

    <div>
        <button type="submit">저장</button>
    </div>
</form>
</body>
</html>