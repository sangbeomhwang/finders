<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>프리랜서 평가</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .subtitle {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .star {
            font-size: 30px;
            cursor: pointer;
            color: #ccc;
        }

        .star::before {
            content: '\2605'; /* 유니코드 별 모양 */
            color: #ccc; /* 기본 색상 */
        }

        .star.selected::before {
            color: #f39c12; /* 선택된 상태의 노란색 */
        }

        .checkbox-group {
            margin-bottom: 20px;
            text-align: center;
        }

        .checkbox-group p {
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: bold;
        }

        .checkbox-group label {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            user-select: none;
            background-color: #f9f9f9;
            transition: background-color 0.2s;
        }

        .checkbox-group input {
            display: none;
        }

        .checkbox-group input:checked + label {
            background-color: #d1ecf1;
            border-color: #007bff;
        }

        .comment-box {
            margin-bottom: 20px;
        }

        .comment-box textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: none; /* 크기 조정 불가능 */
        }

        .buttons {
            display: flex;
            justify-content: space-between;
        }

        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .button.submit {
            background-color: #28a745;
            color: white;
        }

        .button.cancel {
            background-color: #dc3545;
            color: white;
        }

        .button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">프리랜서 평가</h1>
		
		<!-- 필요한 데이터는 서버에서 받아옴 -->
		<div id="review-data"></div>
		
		<!-- 프리랜서 선택 박스 -->
		<div class="freelancer-selection">
		    <label for="freelancerSelect">평가할 프리랜서를 선택하세요:</label>
		    <select id="freelancerSelect">
		        <!-- 서버에서 가져온 프리랜서 목록이 추가됩니다 -->
		    </select>
		</div>
		
        <!-- 프로젝트 만족도 평가 -->
        <div class="subtitle">프로젝트는 만족하셨나요?</div>
        <div class="stars">
            <span class="star" data-value="1"></span>
            <span class="star" data-value="2"></span>
            <span class="star" data-value="3"></span>
            <span class="star" data-value="4"></span>
            <span class="star" data-value="5"></span>
        </div>
        <p id="rating-text" style="text-align: center;">선택하세요.</p>

        <!-- 클라이언트에 대한 평가 항목 -->
        <div class="checkbox-group">
            <p>어떤 점이 마음에 드셨나요? (최대 5개 선택 가능)</p>
            <input type="checkbox" id="item1" value="응답이 빨라요"><label for="item1">응답이 빨라요</label>
            <input type="checkbox" id="item2" value="일정에 맞춰 작업을 완료해요"><label for="item2">일정에 맞춰 작업을 완료해요</label>
            <input type="checkbox" id="item3" value="친절하고 협조적이에요"><label for="item3">친절하고 협조적이에요</label>
            <input type="checkbox" id="item4" value="작업 퀄리티가 높아요"><label for="item4">작업 퀄리티가 높아요</label>
            <input type="checkbox" id="item5" value="기술적 문제를 잘 해결해요"><label for="item5">기술적 문제를 잘 해결해요</label>
            <input type="checkbox" id="item6" value="전문성이 뛰어나요"><label for="item6">전문성이 뛰어나요</label>
            <input type="checkbox" id="item7" value="요구사항을 정확히 반영해요"><label for="item7">요구사항을 정확히 반영해요</label>
            <input type="checkbox" id="item8" value="유연하게 대응해요"><label for="item8">유연하게 대응해요</label>
            <input type="checkbox" id="item9" value="세부 사항까지 꼼꼼해요"><label for="item9">세부 사항까지 꼼꼼해요</label>
            <input type="checkbox" id="item10" value="상세한 피드백을 제공해요"><label for="item10">상세한 피드백을 제공해요</label>
        </div>

        <!-- 평가 코멘트 입력 -->
        <div class="comment-box">
            <textarea placeholder="어떤 점이 좋았나요?"></textarea>
        </div>

        <!-- 버튼 그룹 -->
        <div class="buttons">
            <button class="button cancel" onclick="window.close()">취소</button>
            <button class="button submit">등록</button>
        </div>
    </div>

    <script>
    // 페이지 로드 시 서버에서 필요한 데이터를 가져오는 함수
 function loadReviewData() {
    fetch('/review/getReviewData?projectNum=1') // 실제 프로젝트 번호 사용
        .then(response => response.json())
        .then(data => {
            const { projectNum, clientId, freelancerData } = data;
            
            const reviewDataDiv = document.getElementById('review-data');
            reviewDataDiv.dataset.projectNum = projectNum;
            reviewDataDiv.dataset.clientId = clientId;

            const freelancerSelect = document.getElementById('freelancerSelect');

            if (Array.isArray(freelancerData)) {
                freelancerData.forEach(freelancer => {
                    const option = document.createElement('option');
                    option.value = freelancer.id;
                    option.textContent = freelancer.name;
                    freelancerSelect.appendChild(option);
                });
            } else {
                console.error('Invalid freelancers data format.');
                alert('프리랜서 데이터를 불러오는 중 오류가 발생했습니다.');
            }
        })
        .catch(error => {
            console.error('리뷰 데이터 로드 중 오류:', error);
            alert('리뷰 데이터를 불러오는 중 오류가 발생했습니다.');
        });
}


        // 별점 선택 기능
        document.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', () => {
                let rating = parseFloat(star.getAttribute('data-value'));
                document.getElementById('rating-text').textContent = `${rating}점`;

                // 모든 별을 비활성화
                document.querySelectorAll('.star').forEach(s => s.classList.remove('selected'));

                // 선택한 별까지 활성화
                document.querySelectorAll('.star').forEach(s => {
                    if (parseFloat(s.getAttribute('data-value')) <= rating) {
                        s.classList.add('selected');
                    }
                });
            });
        });

        // 체크박스 선택 제한 (최대 5개까지)
        const checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked').length > 5) {
                    checkbox.checked = false;
                    alert('최대 5개 항목만 선택할 수 있습니다.');
                }
            });
        });
        
        // 페이지 로드 시 데이터 로드
        document.addEventListener('DOMContentLoaded', loadReviewData);
        
     // 등록 버튼 클릭 시
        document.querySelector('.submit').addEventListener('click', () => {
            // 데이터 객체 생성
            const reviewDataDiv = document.getElementById('review-data');
            const projectNum = reviewDataDiv.dataset.projectNum;
            const clientId = reviewDataDiv.dataset.clientId;
            const freelancerId = document.getElementById('freelancerSelect').value;

            const rating = parseFloat(document.getElementById('rating-text').textContent.replace('점', ''));
            const comment = document.querySelector('.comment-box textarea').value;
            const selectedItems = Array.from(document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked'))
                .map(checkbox => ({ itemName: checkbox.value, selected: true }));

            const reviewData = {
                projectNum: parseInt(projectNum, 10),
                clientId: clientId,
                freelancerId: freelancerId,
                rating: rating || 0,
                comment: comment,
                reviewItems: selectedItems
            };

            // 서버로 데이터 전송
            fetch('/review/submitReview', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(reviewData)
            })
            .then(response => {
                if (response.ok) {
                    alert('리뷰가 제출되었습니다.');
                    // 리뷰 제출 후 리스트 페이지로 이동
                    window.location.href = '/project/list'; // 실제 리스트 페이지 URL로 수정하세요
                } else {
                    alert('리뷰 제출에 실패했습니다.');
                }
            })
            .catch(error => {
                console.error('리뷰 제출 오류:', error);
                alert('리뷰 제출 중 오류가 발생했습니다.');
            });
        });

    </script>
</body>
</html>
